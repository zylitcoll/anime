---
import Layout from "../layouts/Layout.astro";

// define types for anime objects coming from API
interface Anime {
  url: string;
  cover: string;
  judul: string;
  lastch?: string;
  lastup?: string;
  [key: string]: any; // fallback for additional properties
}

// Logic Server-side (Fetch Data)
const response = await fetch("https://api.sansekai.my.id/api/anime/latest");
const animeList: Anime[] = await response.json();

// Tentukan Title Halaman
const title = "Update Anime Terbaru";
---

<Layout title={title}>
  <div class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
      <h1 class="text-3xl font-bold mb-8 border-l-4 border-blue-500 pl-4">
        {title}
      </h1>

      <!-- search form -->
      <div class="mb-8">
        <input
          id="searchInput"
          type="text"
          placeholder="Cari anime, mis. one piece"
          class="w-full md:w-1/2 p-2 rounded text-black"
        />
        <button
          id="searchBtn"
          class="ml-2 bg-blue-600 text-white px-4 py-2 rounded">Cari</button
        >
      </div>

      <div
        id="gridContainer"
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6"
      >
        {
          animeList.map((anime) => (
            <div class="group relative bg-gray-800 rounded-lg overflow-hidden shadow-lg transition-transform hover:scale-105">
              <a href={`/anime/${anime.url}`}>
                {/* Image Container */}
                <div class="aspect-3/4 overflow-hidden">
                  <img
                    src={anime.cover}
                    alt={anime.judul}
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                </div>

                {/* Overlay Badge Episode */}
                <div class="absolute top-2 right-2 bg-blue-600 text-xs font-bold px-2 py-1 rounded">
                  {anime.lastch}
                </div>

                {/* Info Text */}
                <div class="p-3">
                  <h2 class="text-sm font-semibold line-clamp-2 min-h-10 group-hover:text-blue-400 transition-colors">
                    {anime.judul}
                  </h2>
                  <p class="text-[10px] text-gray-400 mt-2 flex items-center gap-1">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                    {anime.lastup}
                  </p>
                </div>
              </a>
            </div>
          ))
        }
      </div>
    </div>
  </div>

  <!-- load search script from public folder -->
  <script src="/js/index-search.js" is:inline></script>
</Layout>
